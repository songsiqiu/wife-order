<!--order.wxml-->
<view class="page-container">
  <!-- é¡¶éƒ¨å¯¼èˆªåŒº -->
  <view class="nav-bar">
    <view class="tab-bar">
      <view class="tab-item {{currentTab === 'order' ? 'active' : ''}}" bindtap="switchTab" data-tab="order">
        <text>ç‚¹é¤</text>
      </view>
      <view class="tab-item {{currentTab === 'making' ? 'active' : ''}}" bindtap="switchTab" data-tab="making">
        <text>è®¢å•</text>
        <view wx:if="{{makingOrders.length > 0}}" class="tab-badge">{{makingOrders.length}}</view>
      </view>
    </view>
  </view>

  <!-- ç‚¹é¤é¡µé¢ -->
  <view class="tab-content" wx:if="{{currentTab === 'order'}}">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <view class="header-section">
      <text class="main-title">é€‰æ‹©ä½ çš„</text>
      <text class="main-title-highlight">ç¾é£Ÿ</text>
      <text class="sub-title">ä»Šå¤©æƒ³åƒç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ</text>
    </view>

    <!-- åˆ†ç±»æ ‡ç­¾ -->
    <view class="category-tabs">
      <view 
        wx:for="{{categories}}" 
        wx:key="id" 
        class="category-tab {{currentCategory === item.id ? 'active' : ''}}"
        bindtap="onCategoryChange"
        data-id="{{item.id}}"
      >
        <text>{{item.name}}</text>
      </view>
    </view>

    <!-- ç¾é£Ÿåˆ—è¡¨ -->
    <scroll-view class="food-list" scroll-y="true" enhanced="true" show-scrollbar="{{false}}">
      <view class="food-list-inner">
        <view 
          wx:for="{{filteredFoods}}" 
          wx:key="id" 
          class="food-card"
        >
          <view class="food-image-wrapper">
            <image class="food-image" src="{{item.image}}" mode="aspectFill"></image>
          </view>
          <view class="food-info">
            <text class="food-name">{{item.name}}</text>
            <text class="food-desc">{{item.description}}</text>
          </view>
          <view class="food-action">
            <view class="add-btn" bindtap="onAddItem" data-id="{{item.id}}" data-image="{{item.image}}">
              <text>+</text>
            </view>
          </view>
        </view>
      </view>
    </scroll-view>

    <!-- é£è¡ŒåŠ¨ç”»çƒ -->
    <view 
      wx:for="{{flyBalls}}" 
      wx:key="id" 
      class="fly-ball"
      style="left: {{item.x}}px; top: {{item.y}}px; opacity: {{item.opacity}}; transform: scale({{item.scale}});"
    >
      <image class="fly-image" src="{{item.image}}" mode="aspectFill"></image>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="bottom-bar">
      <view class="total-section" bindtap="onSubmit">
        <view class="total-count {{cartBounce ? 'bounce' : ''}}">
          <text class="count-number">{{totalCount}}</text>
        </view>
        <view class="total-label">
          <text class="label-top">TOTAL</text>
          <text class="label-bottom">ä¸‹å•</text>
        </view>
      </view>
      <view class="voice-btn" bindtouchstart="onVoiceStart" bindtouchmove="onVoiceMove" bindtouchend="onVoiceEnd" bindtouchcancel="onVoiceEnd">
        <text class="voice-btn-text">æŒ‰ä½è¯´è¯</text>
      </view>
    </view>
  </view>

  <!-- å½•éŸ³é®ç½©å±‚ï¼ˆç§»åˆ°æœ€å¤–å±‚ï¼‰ -->
  <view class="recording-mask" wx:if="{{isRecording}}" catchtouchmove="preventMove">
    <view class="recording-center">
      <view class="wave-box {{voiceCancel ? 'cancel' : ''}}">
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
        <view class="wave-bar"></view>
      </view>
    </view>
    <text class="recording-status">{{voiceCancel ? 'æ¾å¼€æ‰‹æŒ‡ï¼Œå–æ¶ˆå‘é€' : 'æ­£åœ¨å½•éŸ³...'}}</text>
    <view class="recording-bottom">
      <view class="cancel-area {{voiceCancel ? 'active' : ''}}" bindtap="onVoiceCancel">
        <text>å–æ¶ˆ</text>
      </view>
      <view class="recording-tip-area">
        <text class="recording-tip">æ¾å¼€ å‘é€</text>
      </view>
    </view>
  </view>

  <!-- åˆ¶ä½œä¸­/è®¢å•é¡µé¢ -->
  <scroll-view class="tab-content making-content" scroll-y="true" wx:if="{{currentTab === 'making'}}">
    <!-- ç©ºçŠ¶æ€ï¼ˆåªåœ¨æ²¡æœ‰åˆ¶ä½œä¸­è®¢å•æ—¶æ˜¾ç¤ºï¼‰ -->
    <view class="empty-state" wx:if="{{makingOrders.length === 0}}">
      <image class="empty-icon" src="/assets/icons/cooking.svg" mode="aspectFit"></image>
      <text class="empty-text">æš‚æ— åˆ¶ä½œä¸­çš„è®¢å•</text>
      <text class="empty-hint">Let's cook something special!</text>
      <view class="go-order-btn" bindtap="switchTab" data-tab="order">
        <text>å¿«å»ç‚¹é¤å§~ â†’</text>
      </view>
    </view>

    <!-- åˆ¶ä½œä¸­è®¢å• -->
    <view wx:if="{{makingOrders.length > 0}}" class="making-list">
      <view class="making-header">
        <text class="making-title">æ­£åœ¨åˆ¶ä½œä¸­...</text>
        <text class="making-hint">ç¾å‘³å³å°†é€è¾¾ ğŸ’•</text>
      </view>
      
      <view class="order-cards">
        <view wx:for="{{makingOrders}}" wx:key="id" class="order-card">
          <view class="order-card-header">
            <text class="order-time">{{item.time}}</text>
            <text class="order-status {{item.allDone ? 'done' : ''}}">{{item.allDone ? 'å·²å®Œæˆ' : 'åˆ¶ä½œä¸­'}}</text>
          </view>
          <view class="order-items">
            <view wx:for="{{item.items}}" wx:for-item="food" wx:key="id" class="order-food-item">
              <image class="order-food-image" src="{{food.image}}" mode="aspectFill"></image>
              <view class="order-food-info">
                <text class="order-food-name">{{food.name}}</text>
                <text class="order-food-qty">x{{food.quantity}}</text>
              </view>
              <view class="order-food-status">
                <image wx:if="{{food.done}}" class="check-icon" src="/assets/icons/check.svg" mode="aspectFit"></image>
                <view wx:else class="loading-spinner"></view>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- å†å²è®¢å• -->
    <view class="history-section">
      <text class="history-month">åäºŒæœˆ</text>
      <view class="history-list">
        <view wx:for="{{historyOrders}}" wx:key="id" class="history-card">
          <view class="history-date">
            <text class="date-month">{{item.month}}</text>
            <text class="date-day">{{item.day}}</text>
          </view>
          <view class="history-info">
            <text class="history-name">{{item.name}} {{item.emoji}}</text>
          </view>
          <view class="history-action" bindtap="onSelectHistory" data-id="{{item.id}}">
            <text>é€‰è¿™ä¸ª</text>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>
